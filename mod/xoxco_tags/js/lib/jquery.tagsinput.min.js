/*

	jQuery Tags Input Plugin 1.3.3

	Copyright (c) 2011 XOXCO, Inc

	Documentation for this plugin lives here:
	http://xoxco.com/clickable/jquery-tags-input

	Licensed under the MIT license:
	http://www.opensource.org/licenses/mit-license.php

	ben@xoxco.com

*/
(function(a){var j=[],g=[];a.fn.doAutosize=function(e){var c=a(this).data("minwidth"),d=a(this).data("maxwidth"),b="",h=a(this),f=a("#"+a(this).data("tester_id"));if(b!==(b=h.val()))b=b.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;"),f.html(b),f=f.width(),e=f+e.comfortZone>=c?f+e.comfortZone:c,f=h.width(),(e<f&&e>=c||e>c&&e<d)&&h.width(e)};a.fn.resetAutosize=function(e){var c=a(this).data("minwidth")||e.minInputWidth||a(this).width(),e=a(this).data("maxwidth")|| e.maxInputWidth||a(this).closest(".tagsinput").width()-e.inputPadding,d=a(this),b=a("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:d.css("fontSize"),fontFamily:d.css("fontFamily"),fontWeight:d.css("fontWeight"),letterSpacing:d.css("letterSpacing"),whiteSpace:"nowrap"}),h=a(this).attr("id")+"_autosize_tester";0<!a("#"+h).length&&(b.attr("id",h),b.appendTo("body"));d.data("minwidth",c);d.data("maxwidth",e);d.data("tester_id",h);d.css("width",c)};a.fn.addTag=function(e, c){c=jQuery.extend({focus:!1,callback:!0},c);this.each(function(){var d=a(this).attr("id"),b=a(this).val().split(j[d]);""==b[0]&&(b=[]);e=jQuery.trim(e);if(c.unique){var h=a(b).tagExist(e);!0==h&&a("#"+d+"_tag").addClass("not_valid")}else h=!1;if(""!=e&&!0!=h){a("<span>").addClass("tag").append(a("<span>").text(e).append("&nbsp;"),a("<a>",{href:"#",title:"Removing tag",text:"x"}).click(function(){return a("#"+d).removeTag(escape(e))})).insertBefore("#"+d+"_addTag");b.push(e);a("#"+d+"_tag").val(""); c.focus?a("#"+d+"_tag").focus():a("#"+d+"_tag").blur();a.fn.tagsInput.updateTagsField(this,b);if(c.callback&&g[d]&&g[d].onAddTag)h=g[d].onAddTag,h.call(this,e);if(g[d]&&g[d].onChange){var f=b.length,h=g[d].onChange;h.call(this,a(this),b[f-1])}}});return!1};a.fn.removeTag=function(e){e=unescape(e);this.each(function(){var c=a(this).attr("id"),d=a(this).val().split(j[c]);a("#"+c+"_tagsinput .tag").remove();str="";for(i=0;i<d.length;i++)d[i]!=e&&(str=str+j[c]+d[i]);a.fn.tagsInput.importTags(this,str); g[c]&&g[c].onRemoveTag&&g[c].onRemoveTag.call(this,e)});return!1};a.fn.tagExist=function(e){return 0<=jQuery.inArray(e,a(this))};a.fn.importTags=function(e){id=a(this).attr("id");a("#"+id+"_tagsinput .tag").remove();a.fn.tagsInput.importTags(this,e)};a.fn.tagsInput=function(e){var c=jQuery.extend({interactive:!0,defaultText:"add a tag",minChars:0,width:"300px",height:"100px",autocomplete:{selectFirst:!1},hide:!0,delimiter:",",unique:!0,removeWithBackspace:!0,placeholderColor:"#666666",autosize:!0, comfortZone:20,inputPadding:12},e);this.each(function(){c.hide&&a(this).hide();var d=a(this).attr("id"),b=jQuery.extend({pid:d,real_input:"#"+d,holder:"#"+d+"_tagsinput",input_wrapper:"#"+d+"_addTag",fake_input:"#"+d+"_tag"},c);j[d]=b.delimiter;if(c.onAddTag||c.onRemoveTag||c.onChange)g[d]=[],g[d].onAddTag=c.onAddTag,g[d].onRemoveTag=c.onRemoveTag,g[d].onChange=c.onChange;var e='<div id="'+d+'_tagsinput" class="tagsinput"><div id="'+d+'_addTag">';c.interactive&&(e=e+'<input id="'+d+'_tag" value="" data-default="'+ c.defaultText+'" />');a(e+'</div><div class="tags_clear"></div></div>').insertAfter(this);a(b.holder).css("width",c.width);a(b.holder).css("height",c.height);""!=a(b.real_input).val()&&a.fn.tagsInput.importTags(a(b.real_input),a(b.real_input).val());if(c.interactive){a(b.fake_input).val(a(b.fake_input).attr("data-default"));a(b.fake_input).css("color",c.placeholderColor);a(b.fake_input).resetAutosize(c);a(b.holder).bind("click",b,function(f){a(f.data.fake_input).focus()});a(b.fake_input).bind("focus", b,function(f){a(f.data.fake_input).val()==a(f.data.fake_input).attr("data-default")&&a(f.data.fake_input).val("");a(f.data.fake_input).css("color","#000000")});if(void 0!=c.autocomplete_url){autocomplete_options={source:c.autocomplete_url};for(attrname in c.autocomplete)autocomplete_options[attrname]=c.autocomplete[attrname];void 0!==jQuery.Autocompleter?(a(b.fake_input).autocomplete(c.autocomplete_url,c.autocomplete),a(b.fake_input).bind("result",b,function(f,b){b&&a("#"+d).addTag(b[0]+"",{focus:!0, unique:c.unique})})):void 0!==jQuery.ui.autocomplete&&(a(b.fake_input).autocomplete(autocomplete_options),a(b.fake_input).bind("autocompleteselect",b,function(f,b){a(f.data.real_input).addTag(b.item.value,{focus:!0,unique:c.unique});return!1}))}else a(b.fake_input).bind("blur",b,function(f){var b=a(this).attr("data-default");""!=a(f.data.fake_input).val()&&a(f.data.fake_input).val()!=b?f.data.minChars<=a(f.data.fake_input).val().length&&(!f.data.maxChars||f.data.maxChars>=a(f.data.fake_input).val().length)&& a(f.data.real_input).addTag(a(f.data.fake_input).val(),{focus:!0,unique:c.unique}):(a(f.data.fake_input).val(a(f.data.fake_input).attr("data-default")),a(f.data.fake_input).css("color",c.placeholderColor));return!1});a(b.fake_input).bind("keypress",b,function(b){if(b.which==b.data.delimiter.charCodeAt(0)||13==b.which)return b.preventDefault(),b.data.minChars<=a(b.data.fake_input).val().length&&(!b.data.maxChars||b.data.maxChars>=a(b.data.fake_input).val().length)&&a(b.data.real_input).addTag(a(b.data.fake_input).val(), {focus:!0,unique:c.unique}),a(b.data.fake_input).resetAutosize(c),!1;b.data.autosize&&a(b.data.fake_input).doAutosize(c)});b.removeWithBackspace&&a(b.fake_input).bind("keydown",function(b){if(8==b.keyCode&&""==a(this).val()){b.preventDefault();var b=a(this).closest(".tagsinput").find(".tag:last").text(),c=a(this).attr("id").replace(/_tag$/,""),b=b.replace(/[\s]+x$/,"");a("#"+c).removeTag(escape(b));a(this).trigger("focus")}});a(b.fake_input).blur();b.unique&&a(b.fake_input).keydown(function(b){(8== b.keyCode||String.fromCharCode(b.which).match(/\w+|[\u00e1\u00e9\u00ed\u00f3\u00fa\u00c1\u00c9\u00cd\u00d3\u00da\u00f1\u00d1,/]+/))&&a(this).removeClass("not_valid")})}return!1});return this};a.fn.tagsInput.updateTagsField=function(e,c){var d=a(e).attr("id");a(e).val(c.join(j[d]))};a.fn.tagsInput.importTags=function(e,c){a(e).val("");var d=a(e).attr("id"),b=c.split(j[d]);for(i=0;i<b.length;i++)a(e).addTag(b[i],{focus:!1,callback:!1});g[d]&&g[d].onChange&&g[d].onChange.call(e,e,b[i])}})(jQuery);